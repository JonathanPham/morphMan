

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using VMTK Tools &mdash; VMTK TOOLS 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="VMTK TOOLS 0.1 documentation" href="index.html"/>
        <link rel="next" title="Documentation for the Python Scripts" href="scripts.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="vmtktools_docs.html" class="icon icon-home"> VMTK TOOLS
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Using VMTK Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#application">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialize-cases">Initialize cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#landmarking">Landmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geometric-manipulation">Geometric manipulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bifurcation-angle-rotation">Bifurcation angle rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cross-sectional-vessel-area-variation">Cross-sectional vessel area variation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#area-variations">Area variations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overall-area-variation">Overall area variation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stenosis-creation-removal">Stenosis creation / removal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#curvature-and-angle-variation-in-the-anterior-bend">Curvature and angle variation in the anterior bend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#curvature-and-torsion-variation-in-the-vessel">Curvature and torsion variation in the vessel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#selection-of-compression-extension-factors">Selection of compression / extension factors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Documentation for the Python Scripts</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="vmtktools_docs.html">VMTK TOOLS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="vmtktools_docs.html">Docs</a> &raquo;</li>
      
    <li>Using VMTK Tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/getting_started.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-vmtk-tools">
<h1>Using VMTK Tools<a class="headerlink" href="#using-vmtk-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="application">
<h2>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<p>This tutorial illustrates the steps for the automated geometric manipulation in patient-spesific morphologies of carotid arteries.
The framework of the algorithm was originally proposed and implemented in Aslak&#8217;s and Henrik&#8217;s master theses (2016, 2018).</p>
<p>The algorithm relies on the definition of Voronoi Diagram and on its properties, particularly on the fact that given the model surface its Voronoi Diagram can be derived and vice versa.</p>
</div>
<div class="section" id="initialize-cases">
<h2>Initialize cases<a class="headerlink" href="#initialize-cases" title="Permalink to this headline">¶</a></h2>
<p>Prior to manipulation, the models need to be initialized by computing their centerline and Voronoi diagram.
The goal of the initialization is to achieve three separate centerlines:</p>
<ol class="arabic simple">
<li>Two single centerlines through each daughter vessel</li>
<li>A single centerline between the daughter vessels</li>
<li>The complete network of centerlines through the model</li>
</ol>
<div class="figure" id="id1">
<img alt="_images/init_cases.png" src="_images/init_cases.png" />
<p class="caption"><span class="caption-text">Figure 1: Expected outcome of initialization, using a representative model</span></p>
</div>
<p>To initialize, run the <code class="docutils literal"><span class="pre">initialize_cases.py</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python initialize_cases.py --dir_path PATH_TO_CASES
</pre></div>
</div>
<p>Running this commando will cause a render window to pop ut, asking you to specify points on the surface which will act as source points.
This will trigger the following prompt:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Please position the mouse and press space to add source points, &#39;u&#39; to undo
</pre></div>
</div>
<div class="figure" id="id2">
<img alt="_images/source_pt.png" src="_images/source_pt.png" />
<p class="caption"><span class="caption-text">Figure 2: Placing source seeds.</span></p>
</div>
<p>To select the source, click on the mesh and a red sphere should appear.
When the source has been selected, press q to continue. Now you&#8217;ll be prompted:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Please position the mouse and press space to add target points, &#39;u&#39; to undo
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="_images/target_pt.png" src="_images/target_pt.png" />
<p class="caption"><span class="caption-text">Figure 3: Placing target seeds.</span></p>
</div>
<p>After selecting target points, press q to continue and the centerlines between the selected points will be computed (may take some time).
By performing these steps three times, you should have the centerlines specified above.
This concludes the initialization.</p>
</div>
<div class="section" id="landmarking">
<h2>Landmarking<a class="headerlink" href="#landmarking" title="Permalink to this headline">¶</a></h2>
<p>Landmarking of the geometry is performed in order to identify different segments of the vessel.
Identification of specific segments is required in order to perform geometric manipulation.
The script <code class="docutils literal"><span class="pre">automated_landmarking.py</span></code> includes implementation of two automated landmarking algorithms; the first introduced by Piccinelli et al. (2011), the second by Bogunović et al. (2014).</p>
<p>Both landmarking algorithms rely on geometric properties of the centerline.
The script allows the user to select one of four different methods to compute the curvature of the discrete centerline:</p>
<ol class="arabic simple">
<li>B-Splines (<code class="docutils literal"><span class="pre">spine</span></code>)</li>
<li>Free-knot regression splines (<code class="docutils literal"><span class="pre">freeknot</span></code>)</li>
<li>Discrete derivatives (<code class="docutils literal"><span class="pre">disc</span></code>)</li>
<li>VMTK (<code class="docutils literal"><span class="pre">vmtk</span></code>)</li>
</ol>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add references to different splining techniques?</p>
</div>
<p>To perform landmarking, run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python automated_landmarking.py --dir_path [PATH_TO_CASES] --algorithm [ALGORITHM] --curv_method [METHOD]
</pre></div>
</div>
<p>This will produce <code class="docutils literal"><span class="pre">landmark_ALGORITHM_CURVMETHOD.particles</span></code> which contains four points defining the interfaces between the segments of the vessel.</p>
<div class="figure" id="id4">
<img alt="_images/landmark.png" src="_images/landmark.png" />
<p class="caption"><span class="caption-text">Figure 4: Landmarked geometry, with interfaces shown as red spheres.</span></p>
</div>
</div>
<div class="section" id="geometric-manipulation">
<h2>Geometric manipulation<a class="headerlink" href="#geometric-manipulation" title="Permalink to this headline">¶</a></h2>
<p>The framework presented here allows for geometric manipulation of four independant
morphological features of the carotid arteries.</p>
<ul class="simple">
<li>Bifurcation angle rotation</li>
<li>Cross-sectional vessel area variation</li>
<li>Curvature variation in the anterior bend</li>
<li>Angle variation in the anterior bend</li>
</ul>
<div class="section" id="bifurcation-angle-rotation">
<h3>Bifurcation angle rotation<a class="headerlink" href="#bifurcation-angle-rotation" title="Permalink to this headline">¶</a></h3>
<p>The script <code class="docutils literal"><span class="pre">move_branches.py</span></code> performes an objective rotation of two daughter branches, moving them a given angle along the bifurcation plane.
In this implementation, positive and negative angles rotate the branches upward and downward, respectively.
The implementation rotates both branches by default, but the user is given the option to only rotate a single branch.
This is achieved by setting the argument <code class="docutils literal"><span class="pre">leave1</span></code> or <code class="docutils literal"><span class="pre">leave2</span></code> to <strong>True</strong>, to leave the first or second branch, respectively.</p>
<p>To perform rotation of the daughter branches, run the following generalized command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python move_branches.py --dir_path [PATH_TO_CASES] --case [CASENAME] --angle [ANGLE] --lower True
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="_images/angle_updown.png" src="_images/angle_updown.png" />
<p class="caption"><span class="caption-text">Figure 5: Rotation of daughter branches, in both directions.</span></p>
</div>
<p>In addition, the script includes two options for reconstruction of the bifurcation, determined by the parameters <code class="docutils literal"><span class="pre">bif</span></code> and <code class="docutils literal"><span class="pre">lower</span></code> set to <strong>True</strong>.
The <code class="docutils literal"><span class="pre">lower</span></code> parameter creates a more realistic looking bifurcation, while the <code class="docutils literal"><span class="pre">bif</span></code> parameter creates a straight segment between the daughter branches.
A comparison is shown below, where the straight segment is created by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python move_branches.py --dir_path [PATH_TO_CASES] --case [CASENAME] --angle [ANGLE] --bif True
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="_images/angle_bif.png" src="_images/angle_bif.png" />
<p class="caption"><span class="caption-text">Figure 6: Rotation of daughter branches with different reconstruction of the bifurcation.</span></p>
</div>
</div>
<div class="section" id="cross-sectional-vessel-area-variation">
<h3>Cross-sectional vessel area variation<a class="headerlink" href="#cross-sectional-vessel-area-variation" title="Permalink to this headline">¶</a></h3>
<p>Manipulation of the cross-sectional area of a vessel is performed by running the script <code class="docutils literal"><span class="pre">area_variations.py</span></code>. The script performs geometric manipulation along the a vessel, represented by a centerline.
In order to preserve the inlet and the end of the geometry segment, the first and last 10% of the area of interest are left untouched.</p>
<p>The script <code class="docutils literal"><span class="pre">area_variations.py</span></code> has been extended to include several options related to the vessel area:</p>
<ul class="simple">
<li>Area variations of the vessel</li>
<li>Overall area increase / decrease</li>
<li>Stenosis creation / removal</li>
<li>Vessel tapering (?)</li>
</ul>
<div class="section" id="area-variations">
<h4>Area variations<a class="headerlink" href="#area-variations" title="Permalink to this headline">¶</a></h4>
<p>Area variation is initialized by a factor <span class="math">\(\beta\)</span> or a ratio, <span class="math">\(R = A_{min} / A_{max}\)</span>.
The script takes <code class="docutils literal"><span class="pre">beta</span></code> and <code class="docutils literal"><span class="pre">ratio</span></code> as command line arguments.
However, the script requires only one of the two parameters to perform area variation.
Setting <span class="math">\(\beta &lt; 0\)</span> will cause the ratio <span class="math">\(R\)</span> to decrease,  whereas <span class="math">\(\beta &gt; 0\)</span> will cause the ratio to increase.
The ratio, <span class="math">\(R\)</span>, behaves as shown in the illustration below.</p>
<p>To perform area variations of the vessel area, run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python area_variations.py --dir_path [PATH_TO_CASES] --case [CASENAME] --smooth True --beta 0.5
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python area_variations.py --dir_path [PATH_TO_CASES] --case [CASENAME] --smooth True --ratio 0.5
</pre></div>
</div>
<div class="figure" id="id7">
<img alt="_images/area_vary.png" src="_images/area_vary.png" />
<p class="caption"><span class="caption-text">Figure : Area variations throughout the geometry for different ratios.</span></p>
</div>
</div>
<div class="section" id="overall-area-variation">
<h4>Overall area variation<a class="headerlink" href="#overall-area-variation" title="Permalink to this headline">¶</a></h4>
<p>The area of interest can also be increase or decreased overall, by using the <code class="docutils literal"><span class="pre">percentage</span></code> argument.
The <code class="docutils literal"><span class="pre">percentage</span></code> argument determines the percentage to increase or decrease the overall area.</p>
<p>To perform overall increase or decrease of the area of interest, run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python area_variations.py --dir_path [PATH_TO_CASES] --case [CASENAME] --smooth True --percentage [%]
</pre></div>
</div>
<p>Below is an illustration of area decrease and increase in a single patient-specific model.</p>
<div class="figure" id="id8">
<img alt="_images/area_decinc.png" src="_images/area_decinc.png" />
<p class="caption"><span class="caption-text">Figure : Decrease and increase in overall area.</span></p>
</div>
</div>
<div class="section" id="stenosis-creation-removal">
<h4>Stenosis creation / removal<a class="headerlink" href="#stenosis-creation-removal" title="Permalink to this headline">¶</a></h4>
<p>The framework allows for creation or removal of one stenosis located along the area of interest.
Creation and removal of a stenosis is performed by setting input argument <code class="docutils literal"><span class="pre">stenosis</span></code> to <strong>True</strong>.
Spesifically for stenosis creation, the input arguments <code class="docutils literal"><span class="pre">percentage</span></code> and <code class="docutils literal"><span class="pre">size</span></code> determine the narrowness and length of the stenosis, respectively.
The <code class="docutils literal"><span class="pre">size</span></code> argument is a factor multiplied with the radius at the selected center point of the stenosis, in order to expand the stenosis exposed area.
For creation of a stenosis, run the follwing command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python area_variations.py --dir_path [PATH_TO_CASES] --case [CASENAME] --smooth True --percentage [%] --stenosis True --size [SIZE]
</pre></div>
</div>
<p>Running this commando will cause a render window to pop ut, asking you to specify points on the surface which will act as the center point of the stenosis.
This will trigger the following prompt, with a suggested point placement:</p>
<div class="figure" id="id9">
<img alt="_images/single_stenosis.png" src="_images/single_stenosis.png" />
<p class="caption"><span class="caption-text">Figure : Placing point where stenosis is centered.</span></p>
</div>
<div class="figure" id="id10">
<img alt="_images/change_stenosis.png" src="_images/change_stenosis.png" />
<p class="caption"><span class="caption-text">Figure : Comparison of new and old model, with and without stenosis.</span></p>
</div>
<p>Similarly, removal of a stenosis is achieved by running the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python area_variations.py --dir_path [PATH_TO_CASES] --case [CASENAME] --smooth True --stenosis True
</pre></div>
</div>
<p>The commando will cause a render window to pop ut, asking you to specify points on the surface which will now act as the boundaries of the stenosis.
This will trigger the following prompt, with a suggested point placement:</p>
<div class="figure" id="id11">
<img alt="_images/place_stenosis.png" src="_images/place_stenosis.png" />
<p class="caption"><span class="caption-text">Figure : Placing points to indentify the boundaries of the stenosis.</span></p>
</div>
<div class="figure" id="id12">
<img alt="_images/fixed_stenosis.png" src="_images/fixed_stenosis.png" />
<p class="caption"><span class="caption-text">Figure : Comparison of new and old model, with and without stenosis.</span></p>
</div>
</div>
</div>
<div class="section" id="curvature-and-angle-variation-in-the-anterior-bend">
<h3>Curvature and angle variation in the anterior bend<a class="headerlink" href="#curvature-and-angle-variation-in-the-anterior-bend" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Manipulation is initialized by selecting a segment of the vessel, bounded by two clipping points.
The two clipping points can be freely chosen along the centerline, but it is highly recommended to landmark the geometry in order to objectively segment the geometry, and use the resulting landmarking points as clipping points.</p>
</div>
<p>Adjusting curvature and angle in the anterior bend utilizes a common script: <code class="docutils literal"><span class="pre">move_siphon.py</span></code>. The script performs geometric manipulation of the anterior bend segment, as defined in the landmarking section.
Adjusting the anterior bend relies only on two parameters, the compression/extension factors <span class="math">\(\alpha \text{ and } \beta\)</span>. Selection of these factors in order to increase or decrease the curvature or angle of the anterior bend is performed by the scripts <code class="docutils literal"><span class="pre">automated_geometric_quantities.py</span></code> and <code class="docutils literal"><span class="pre">calculate_alpha_beta_values.py</span></code>. The pipeline for increasing or decreasing either peak curvature or the bend angle in the anterior bend is described below.</p>
<p>Alternatively the user may choose any arbitrary values for <span class="math">\(\alpha \text{ and } \beta\)</span>.</p>
<p>To perform geometric manipulation of the anterior bend, run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>python move_siphon.py --dir_path [PATH_TO_CASES] --case [CASENAME] --alpha [ALPHA] --beta [BETA]
</pre></div>
</div>
<p>In general, the compression / extension factors <span class="math">\(\alpha \text{ and } \beta\)</span> determine the magnitude and direction in which the anterior bend is translated. The manipulation script allows movement in two directions:</p>
<ul class="simple">
<li>Vertical, determined by <span class="math">\(\alpha\)</span></li>
<li>Horizontal, determined by <span class="math">\(\beta\)</span></li>
</ul>
<div class="figure" id="id13">
<img alt="_images/alpha.png" src="_images/alpha.png" />
<p class="caption"><span class="caption-text">Figure 6: Movement in the vertical direction, determined by <span class="math">\(\alpha\)</span></span></p>
</div>
<div class="figure" id="id14">
<img alt="_images/beta.png" src="_images/beta.png" />
<p class="caption"><span class="caption-text">Figure 7: Movement in the horizontal direction, determined by <span class="math">\(\beta\)</span></span></p>
</div>
</div>
<div class="section" id="curvature-and-torsion-variation-in-the-vessel">
<h3>Curvature and torsion variation in the vessel<a class="headerlink" href="#curvature-and-torsion-variation-in-the-vessel" title="Permalink to this headline">¶</a></h3>
<div class="figure" id="id15">
<img alt="_images/smoothedsiphon.png" src="_images/smoothedsiphon.png" />
<p class="caption"><span class="caption-text">Figure 7: Sharpened and smoothened version of the siphon.</span></p>
</div>
<div class="section" id="selection-of-compression-extension-factors">
<h4>Selection of compression / extension factors<a class="headerlink" href="#selection-of-compression-extension-factors" title="Permalink to this headline">¶</a></h4>
<p>The compression / extension factors <span class="math">\(\alpha \text{ and } \beta\)</span> determine the magnitude and direction in which the anterior bend is translated.
Running the scripts  <code class="docutils literal"><span class="pre">automated_geometric_quantities.py</span></code> and <code class="docutils literal"><span class="pre">calculate_alpha_beta_values.py</span></code> is required if the user is interested in reaching a spesific change in angle or curvature.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scripts.html" class="btn btn-neutral float-right" title="Documentation for the Python Scripts" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Aslak Bergersen &amp; Henrik Kjeldsberg.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>